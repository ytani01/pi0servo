# GEMINI.md

## == Serena MCP server

Read the initial instructions of serena MCP.
@serena activate current directory
@serena onboarding
@serena switch_mode ["planning", "one-shot"]
@serena switch_mode ["editing", "interactive"]
@serena think_about_whether_you_are_done


## == 目的

- サーボ用 Python ドライバ
- **Raspberry Pi Zero 2W** など低スペックでも動作
- **pigpio** 使用
- ライブラリ利用 + CLIで確認・デモ可能


## == 全体ルール

- 安易に試行錯誤をせず、情報をしっかり調べること。
- ファイル編集に失敗したら: ファイル更新は新規作成→差替え


### === 学習とデバッグの原則

過去の失敗を繰り返さず、効率的な問題解決を確実にするために：

- **公式ドキュメントの精読:** コア機能、設定、認証については、常に一次情報源を参照する。二次情報源からの推測は避ける。
- **すべての仮説の検証:** 命名、暗黙の挙動、デフォルト設定に関する仮説を問い直し、検証する。未確認のパターンに基づいて進めない。
- **体系的な問題の切り分け:** 予期せぬ挙動に遭遇した場合、各コンポーネント（例：環境変数、ツール実行、サブプロセス）をテストし、根本原因を特定する。
- **詳細ログの活用:** 利用可能な場合、デバッグオプション（`-v`など）を使用し、内部の洞察を得て、失敗を特定する。
- **ユーザーフィードバックの尊重:** 詳細な報告を継続的な学習と問題診断に活用する。


## == プロジェクトについて

- **`git commit`はユーザーのみ**
- 必要時にコミット促し、1行英語メッセージ案を示す

- 設定管理は `uv`, `pyproject.toml` を使用（最新版の仕様確認を怠らないこと）
- コマンド実行: `uv run ...`
- ライブラリ追加: `uv add ...`
  - `pip`は基本的に使わないこと。

- リンティング:
  - `uv run ruff check ...`
  - `uv run mypy ...`
  - `uv run pyright ...`
  - `uv run flake8 ...`

- テスト: `tests/`以下に作成、連番で番号付けし、実行は `uv run python -m pytest -v ...`


## == コーディング
- コメントは日本語
- 行長 78文字以内
- ログは `my_logger.py` の `get_logger()`使用（変更禁止）


## == タスク管理: `ToDo.md` / `Tasks.md`

- `ToDo.md`: ユーザーのみが、作成・編集・管理する。AIは参照のみ可能。
- `Tasks.md`: AIが作成・編集・管理する。

- `ToDo.md`と`Tasks.md`がプロジェクトルートに存在するか確認する。
  - どちらも存在しない場合、何もしないでユーザーに指示を仰ぐ。

- 作業開始前に、必ず `Tasks.md` を作成
  - 実行開始前に、必ずユーザーに確認を求める。
  - ユーザーが '進めて' というまで、作業を進めない。
  - 作業開始後、 `Tasks.md`の項目については、連続実行してよい。


### === `Tasks.md` がある場合

- `Tasks.md`のマークされてないタスクから順に実行
- `Tasks.md`のタスク項目が一つ完了したら、
  次の項目に進む前に完了した項目にマークすること

- コード変更時は、常に以下を実施:
  - リンティング
  - テストの作成・更新・実行

- `Tasks.md` のすべてのタスクが完了した場合:- 
  1. ユーザーに完了を報告し、ユーザーが `ToDo.md`を更新するよう促す。
  2. `uv run archive_file.py` 実行
     - このスクリプトは、`Tasks.md` を
       -  `yyyymmdd-HHMMSS-Tasks-done.md` にリネームし
       - `archives/`へ移動する。

### === `Tasks.md` がない場合

- `ToDo.md` マークされていない先頭の項目を特定する。
- `ToDo.md`の項目1つを詳細なタスクに分割して、`Tasks.md`にチェックリスト作成。
- `Tasks.md`は、必ず **日本語**で作成。
- 原則として、`ToDo.md`の1項目につき1つの`Tasks.md`を作成する。
- `Tasks.md`作成後、ユーザーが "進めて" と言うまで、実行を開始しない。


