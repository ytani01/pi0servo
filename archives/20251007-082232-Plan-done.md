# `tests/test_04_multi_servo.py` の簡素化計画

`tests/test_04_multi_servo.py` の分析に基づき、テストファイルを簡素化するためのステップバイステップの計画を以下に示します。この計画を `Plan.md` に記述します。

1.  **`mock_calibrable_servo` フィクスチャの簡素化:**
    *   すべてのパッチ適用に `pytest-mock` の `mocker` フィクスチャを使用します。
    *   `side_effect` を持つ `MagicMock` のリストの代わりに、`CalibrableServo` 用の単一のモックを作成し、`mocker.PropertyMock` を使用してそのプロパティをモックします。これにより、フィクスチャが短くなり、理解しやすくなります。
    *   `side_effect` は、モックされた `CalibrableServo` の各呼び出しの戻り値を設定するループに置き換えることができます。

2.  **`multi_servo` フィクスチャのリファクタリング:**
    *   フィクスチャ自体はほとんど問題ありませんが、`mock_calibrable_servo` の変更の結果として簡素化されます。

3.  **`TestMultiServo` テストの改善:**
    *   `test_init`: 初期化テストを `multi_servo` フィクスチャと組み合わせて、重複を減らします。
    *   `test_move_all_angles_sync*` テスト:
        *   アサーションをより小さく、より焦点の合ったチェックに分割します。
        *   `time.sleep` を直接モックする代わりに、タイミングに依存せずにロジックをテストできるかどうかを検討するか、タイミングが重要な場合は `freezegun` のようなライブラリを使用します。
        *   `test_move_all_angles_sync_str_none` については、`target_angles` リスト内の文字列と `None` 値の処理という、テスト対象をより明確にすることができます。
