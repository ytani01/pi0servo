[tasks.upgradesys]
description = "upgrade global tools"
run = '''
# upgrade global
echo "# apt"
LANG=C sudo apt update
LANG=C sudo apt upgrade
LANG=C sudo apt autoremove -y

echo "# mise"
mise self-update
mise up

echo "# uv"
uv tool upgrade --all
'''
alias = "upsys"

[tasks.upgradelocal]
description = "upgrade in this project"
run = '''
# upgrade this project

echo "# rm uv.lock"
rm uv.lock

echo "# uv sync"
uv sync

echo "# pyclickutils"
uv add -U ../pyclickutils

echo "# pyclibase"
uv add -U ../pyclibase

echo "# pip"
uv pip install -U --group dev -e .
uv pip install -U --group samples -e .

echo "# uv run pi0servo -V"
uv run pi0servo -V
'''
alias = "uplocal"
depends = ["upgradesys"]

[tasks.lint]
description = "linting"
run = '''
# format and linting

#  echo "# isort"
# uv run isort --diff src samples tests

echo "# ruff"
uv run ruff format src samples tests
uv run ruff check --fix --extend-select I  src samples tests

# echo "# pyright"
# uv run pyright src samples tests

echo "# mypy"
uv run mypy src samples tests

uv run pi0servo -V
'''
depends = ["upgradelocal"]

[tasks.test]
description = "test"
run = '''
uv run pytest -v tests

uv run pi0servo -V
'''
depends = ["lint"]
